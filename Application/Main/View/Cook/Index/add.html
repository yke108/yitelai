<!-------头部开始----->
<include file="Public/header"/>
<!-------头部结束----->





<!-------我要发布开始----->
<div class="release_form w1200">
	<h1>感谢您的分享，请上传您的杰作吧！</h1>
	<form action="{:U('')}" onSubmit="">
		<div class="release_form_item">
			<h2>作品信息</h2>
			<p><span>标题<font>（10个字之内）</font></span></p>
			<p><input name="name" value="{$info.name}" type="text" placeholder="请输入菜谱的名称"></p>
			<p><span>主图<font>（请上传一张800*800像素的成品图）</font></span></p>
			<div class="upload_pic"><input type="file" class="hy_upload_single" hy_field="picture" style="width:77px; height:77px;" value="上传图片" src=""></div>
			<p><span>属性</span></p>
			<p>
				<select name="tech">
					<option value="">工艺</option>
					<foreach name="cook_config.tech" item="vo" key="ko">
						<option value="{$vo}" {:m_selected($vo, $info[tech])}>{$vo}</option>
					</foreach>
				</select>
				<select name="difficulty">
					<option value="">难度</option>
					<foreach name="difficulty_list" item="vo" key="ko">
						<option value="{$ko}" {:m_selected($ko, $info[difficulty])}>{$vo}</option>
					</foreach>
				</select>
				<select name="number">
					<option value="">人数</option>
					<foreach name="number_list" item="vo" key="ko">
						<option value="{$ko}" {:m_selected($ko, $info[number])}>{$vo}</option>
					</foreach>
				</select>
				<select name="taste">
					<option value="">口味</option>
					<foreach name="cook_config.taste" item="vo" key="ko">
						<option value="{$vo}" {:m_selected($vo, $info[taste])}>{$vo}</option>
					</foreach>
				</select>
				<select name="prepare_time">
					<option value="">准备时间</option>
					<foreach name="preparetime_list" item="vo" key="ko">
						<option value="{$ko}" {:m_selected($ko, $info[prepare_time])}>{$vo}</option>
					</foreach>
				</select>
				<select name="cook_time">
					<option value="">烹饪时间</option>
					<foreach name="cooktime_list" item="vo" key="ko">
						<option value="{$ko}" {:m_selected($ko, $info[cook_time])}>{$vo}</option>
					</foreach>
				</select>
			</p>
		</div>
		<div class="release_form_item">
			<h2>使用材料</h2>
			<p><span>主料<button type="button" class="add_main">添加主料</button></span></p>
			<div class="clearfix main_list">
				<dl class="clearfix">
					<dt><input type="file" class="hy_upload_single" hy_field="main_material[picture][]" style="width:75px; height:75px;" value="上传图片" src=""></dt>
					<dd>
						<p><input name="main_material[name][]" type="text" placeholder="请填写用料名称"></p>
						<p><input name="main_material[dosage][]" type="text" placeholder="请填写用量（如50g）"></p>
					</dd>
				</dl>
				<dl class="clearfix">
					<dt><input type="file" class="hy_upload_single" hy_field="main_material[picture][]" style="width:75px; height:75px;" value="上传图片" src=""></dt>
					<dd>
						<p><input name="main_material[name][]" type="text" placeholder="请填写用料名称"></p>
						<p><input name="main_material[dosage][]" type="text" placeholder="请填写用量（如50g）"></p>
					</dd>
				</dl>
				<dl class="clearfix">
					<dt><input type="file" class="hy_upload_single" hy_field="main_material[picture][]" style="width:75px; height:75px;" value="上传图片" src=""></dt>
					<dd>
						<p><input name="main_material[name][]" type="text" placeholder="请填写用料名称"></p>
						<p><input name="main_material[dosage][]" type="text" placeholder="请填写用量（如50g）"></p>
					</dd>
				</dl>
			</div>
			<p><span>辅料<button type="button" class="add_sub">添加辅料</button></span></p>
			<div class="clearfix sub_list">
				<dl class="clearfix">
					<dt><input type="file" class="hy_upload_single" hy_field="sub_material[picture][]" style="width:75px; height:75px;" value="上传图片" src=""></dt>
					<dd>
						<p><input name="sub_material[name][]" type="text" placeholder="请填写用料名称"></p>
						<p><input name="sub_material[dosage][]" type="text" placeholder="请填写用量（如50g）"></p>
					</dd>
				</dl>
				<dl class="clearfix">
					<dt><input type="file" class="hy_upload_single" hy_field="sub_material[picture][]" style="width:75px; height:75px;" value="上传图片" src=""></dt>
					<dd>
						<p><input name="sub_material[name][]" type="text" placeholder="请填写用料名称"></p>
						<p><input name="sub_material[dosage][]" type="text" placeholder="请填写用量（如50g）"></p>
					</dd>
				</dl>
				<dl class="clearfix">
					<dt><input type="file" class="hy_upload_single" hy_field="sub_material[picture][]" style="width:75px; height:75px;" value="上传图片" src=""></dt>
					<dd>
						<p><input name="sub_material[name][]" type="text" placeholder="请填写用料名称"></p>
						<p><input name="sub_material[dosage][]" type="text" placeholder="请填写用量（如50g）"></p>
					</dd>
				</dl>
			</div>
		</div>
		<div class="release_form_item">
			<h2>制作步骤</h2>
			<div class="step_list">
				<div class="special_step">
					<p><span>步骤1</span></p>
					<dl class="clearfix">
						<dt><input type="file" class="hy_upload_single" hy_field="steps[picture][]" style="width:170px; height:170px;" value="上传图片" src=""></dt>
						<dd><textarea name="steps[description][]" cols="" rows="" placeholder="请描述"></textarea></dd>
					</dl>
				</div>
				<div class="special_step">
					<p><span>步骤2</span></p>
					<dl class="clearfix">
						<dt><input type="file" class="hy_upload_single" hy_field="steps[picture][]" style="width:170px; height:170px;" value="上传图片" src=""></dt>
						<dd><textarea name="steps[description][]" cols="" rows="" placeholder="请描述"></textarea></dd>
					</dl>
				</div>
			</div>
			<div class="add_step"><button type="button">添加步骤</button></div>
		</div>
		<div class="save_release"><button type="button" id="btn_submit">保存并发布</button></div>
	</form>
</div>
<!-------我要发布结束----->



<!-------底部开始----->
<include file="Public/footer"/>
<!-------底部结束----->

<style type="text/css">
.hy_upload_single:before,.hy_upload_single:after{content:" ";position:absolute;top:50%;left:50%;-webkit-transform:translate(-50%,-50%);transform:translate(-50%,-50%);background-color:#d9d9d9;}
.hy_upload_single:before{ width:2px; height:50%;}
.hy_upload_single:after{ width:50%; height:2px;}
.weui_uploader_input{opacity:1;}
input:disabled{background:#eee !important;}
</style>
<script charset="utf-8" src="__PUBLIC__/editor/kindeditor.js"></script>
<script src="__PUBLIC__/main/special/js/singleupload.js"></script>
<script src="__PUBLIC__/main/special/js/multiupload.js"></script>
<script type="text/javascript">
$(document).ready(function(){
	$('.hy_upload_single').hySingleUpload("{:U('site/upload/index')}", '__UPLOAD__');
	$('.hy_upload_multi').hyMultiUpload("{:U('site/upload/index')}", '__UPLOAD__');
	
	$('.add_main').click(function(){
		var li = '<dl class="clearfix">' +
					'<dt><input type="file" class="hy_upload_single" hy_field="main_material[picture][]" style="width:75px; height:75px;" value="上传图片" src=""></dt>' +
					'<dd>' +
						'<p><input name="main_material[name][]" type="text" placeholder="请填写用料名称"></p>' +
						'<p><input name="main_material[dosage][]" type="text" placeholder="请填写用量（如50g）"></p>' +
					'</dd>' +
				'</dl>';
		$('.main_list').append(li);
		$('dl dt').children('.hy_upload_single').hySingleUpload("{:U('site/upload/index')}", '__UPLOAD__');
	});
	
	$('.add_sub').click(function(){
		var li = '<dl class="clearfix">' +
					'<dt><input type="file" class="hy_upload_single" hy_field="sub_material[picture][]" style="width:75px; height:75px;" value="上传图片" src=""></dt>' +
					'<dd>' +
						'<p><input name="sub_material[name][]" type="text" placeholder="请填写用料名称"></p>' +
						'<p><input name="sub_material[dosage][]" type="text" placeholder="请填写用量（如50g）"></p>' +
					'</dd>' +
				'</dl>';
		$('.sub_list').append(li);
		$('dl dt').children('.hy_upload_single').hySingleUpload("{:U('site/upload/index')}", '__UPLOAD__');
	});
	
	$('.add_step').click(function(){
		var index = $('.step_list dl').length;
		index += 1;
		var li = '<div class="special_step">' +
					'<p><span>步骤'+index+'</span></p>' +
					'<dl class="clearfix">' +
						'<dt><input type="file" class="hy_upload_single" hy_field="steps[picture][]" style="width:170px; height:170px;" value="上传图片" src=""></dt>' +
						'<dd><textarea name="steps[description][]" cols="" rows="" placeholder="请描述"></textarea></dd>' +
					'</dl>' +
				'</div>';
		$('.step_list').append(li);
		$('dl dt').children('.hy_upload_single').hySingleUpload("{:U('site/upload/index')}", '__UPLOAD__');
	});
	
	$('#btn_submit').click(function(){
		var form = $(this).parents('form')
		$.post(form.attr('action'), form.serialize(), function(d){
			layer.open({time:1,content:d.info});
			if(d.url){
				window.location.href = d.url
			}
		}, 'json');
	});
});
</script>